!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("chrono-node"),require("moment")):"function"==typeof define&&define.amd?define(["chrono-node","moment"],t):e.IntentParser=t(e.chrono,e.moment)}(this,function(e,t){"use strict";e="default"in e?e.default:e,t="default"in t?t.default:t;var r=(function(){function e(e){this.value=e}function t(t){function r(e,t){return new Promise(function(r,i){var s={key:e,arg:t,resolve:r,reject:i,next:null};a?a=a.next=s:(o=a=s,n(e,t))})}function n(r,o){try{var a=t[r](o),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){n("next",e)},function(e){n("throw",e)}):i(a.done?"return":"normal",a.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}o=o.next,o?n(o.key,o.arg):a=null}var o,a;this._invoke=r,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),n=function(){function e(){r(this,e)}return e.prototype.clean=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{raw:""},t=e.raw.replace(/\s+/g," ").trim();return e.text=t,e.cleaned=t,Promise.resolve(e)},e}(),i=function(){function e(){r(this,e)}return e.prototype.clean=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},t=e.cleaned.replace(/\b(let)'s\b/gi,"$1 us").replace(/'s (been|got|gotten)\b/gi," has $1").replace(/'s (being|going)\b/gi," is $1").replace(/'d (like|love)\b/gi," would $1").replace(/\b(should)n't've\b/gi,"$1 not have").replace(/\b(would)n't've\b/gi,"$1 not have").replace(/\b(could)n't've\b/gi,"$1 not have").replace(/\b(s)han't\b/gi,"$1hall not").replace(/\b(w)on't\b/gi,"$1ill not").replace(/\b(c)an't\b/gi,"$1annot").replace(new RegExp("\\b(am|are|could|did|do|does|had|has|have|is|might|must|should|was|were|would)n't\\b","ig"),"$1 not").replace(/\b(g)onna\b/gi,"$1oing to").replace(/\b(w)anna\b/gi,"$1ant to").replace(/'ll\b/gi," will").replace(/'re\b/gi," are").replace(/'ve\b/gi," have").replace(/'m\b/gi," am");return e.cleaned=t,Promise.resolve(e)},e}(),o={en:"[-‐–—,;:!?.…'‘’\"“”()[\\]§@*/&#†‡′″]",fr:'[-‐–—,;:!?.…’"“”«»()[\\]§@*/&#†‡]',ja:'[-‾_＿－‐—―〜・･,，、､;；:：!！?？.．‥…。｡＇‘’"＂“”(（)）\\[［\\]］{｛}｝〈〉《》「｢」｣『』【】〔〕‖§¶@＠*＊/／\\＼&＆#＃%％‰†‡′″〃※]'},a=function(){function e(){r(this,e)}return e.prototype.clean=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},t=e.cleaned.replace(new RegExp("^(?:Hello|Hey|Hi|Yo)"+o.en+"* (.)","iu"),function(e,t){return t.toUpperCase()});return e.cleaned=t,Promise.resolve(e)},e}(),s=function(){function e(){r(this,e)}return e.prototype.clean=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},t=e.cleaned.replace(new RegExp("^(?:Can you |Can you please |Please can you |Please |Please do |Will you |Will you please )?remind\\b","i"),"Remind").replace(new RegExp("^(?:Can you tell me |Can you please tell me |Please tell me |Please do tell me |Tell me |Will you tell me |Will you please tell me )?wh(at|ere|en)\\b","i"),"Wh$1");return t!==e.cleaned&&(t.match(/^Remind\b/i)?t=t.replace(/\?+$/,"."):t.match(/^Wh(at|ere|en)\b/i)&&(t=t.replace(/\.+$/,"?"))),e.cleaned=t,Promise.resolve(e)},e}(),l=new e.Parser;l.pattern=function(){return new RegExp("midnight|morning|in the morning|noon|afternoon|in the afternoon|evening|in the evening|night|at night","i")},l.extract=function(t,r,n){var i=void 0,o=void 0;switch(n[0].toLowerCase()){case"midnight":i=0,o=0;break;case"morning":case"in the morning":i=9,o=0;break;case"noon":i=12,o=1;break;case"afternoon":case"in the afternoon":i=15,o=1;break;case"evening":case"in the evening":i=19,o=1;break;case"night":case"at night":i=22,o=1}return new e.ParsedResult({ref:r,text:n[0],index:n.index,start:{hour:i,meridiem:o}})};var u=new e.Refiner;u.refine=function(e,t){function r(e,t){!e.isCertain("meridiem")&&e.moment(t).isSame(e,"day")&&e.get("hour")<=t.getHours()&&(e.assign("meridiem",1),e.assign("hour",e.get("hour")+12))}var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.forwardHoursOnly!==!0?t:(t.forEach(function(e){r(e.start,e.ref),e.end&&r(e.end,e.ref)}),t)};var c=new Date,m=new e.Chrono(e.options.casualOption());m.parsers.push(l),m.refiners.push(u);var f={setRef:function(e){return c=e},parse:function(e){return m.parse(e,c,{forwardDatesOnly:!0,forwardHoursOnly:!0})}},p=Object.freeze({normaliseTimes:Symbol("normaliseTimes")}),h=function(){function e(){r(this,e)}return e.prototype.parse=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},t=this[p.normaliseTimes](e.cleaned),r=f.parse(t);if(!r.length)return e.time=null,Promise.resolve(e);var n=r.map(function(e){var r=e.start?Number(e.start.date()):null,n=e.end?Number(e.end.date()):null,i=e.text,o=t.substr(0,e.index)+t.substr(e.index+i.length);return{start:r,end:n,extractedText:i,processedText:o}});return e.time=n,Promise.resolve(e)},e.prototype[p.normaliseTimes]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/([0-9]) ?p\.m\./gi,"$1 PM").replace(/([0-9]) ?a\.m\./gi,"$1 AM")},e}(),d={en:{patterns:[/^Remind (.+?) (?:to|at|on|by|that|about)\b/i,/^Where (?:am|are|is) (.+?) (?:at|on|by)\b/i,/^Where (?:am|are|is) (.+?) supposed to\b/i,/^Where should (.+?) go\b/i,/^What (?:am|are|is) (.+?) doing\b/i,/^What (?:am|are|is) (.+?) supposed to\b/i,/^What should (.+?) do\b/i,/^What (?:do|does) (.+?) do\b/i,/^What is (.+?)(?:'s)? (?:schedule|planning|calendar|agenda)\b/i,/([^ ]+ (?:and|&) [^ ]+)/i],listBreaker:/,? (?:and|&) |, /gi},fr:{patterns:[/Rappelle (.+?) de (?:.+)/i,/Rappelle (.+?) d'(?:.+)/i,/Rappelle-(.+?) de (?:.+)/i,/Rappelle-(.+?) d'(?:.+)/i],listBreaker:/,? (?:et|&) |, /gi},ja:{patterns:[/(?:.+)を(.+)に思い出させて/i,/(.+)に(?:.+)を思い出させて/i,/(.+)は(?:.+)と言うリマインダーを作成して/i],listBreaker:new RegExp("、","gu")}},y=Object.freeze({users:Symbol("users"),normalise:Symbol("normalise"),parseUsers:Symbol("parseUsers")}),b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];r(this,e),this[y.users]=t}return e.prototype.parse=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},r=t.cleaned,n=null;return d.en.patterns.some(function(t){var i=t.exec(r);return!!i&&(n=e[y.parseUsers](i[1]),!!n.length)}),t.recipients=n,Promise.resolve(t)},e.prototype[y.parseUsers]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.split(d.en.listBreaker).map(function(e){return e.trim()}).filter(function(e){return!!e})},e}(),v={en:{patterns:[/Remind (?:.+?) (?:to|at|on|by|that|about) (.+)/i,/Remind (?:.+?) that (?:it|there) is (.+)/i],punctuation:/[-‐–—,;:!?.…'‘’"“”()[\]§@*\/&#†‡′″]+$/},fr:{patterns:[/Rappelle (?:.+?) de (.+)/i,/Rappelle (?:.+?) d'(.+)/i,/Rappelle-(?:.+?) de (.+)/i,/Rappelle-(?:.+?) d'(.+)/i],punctuation:/[-‐–—,;:!?.…’"“”«»()[\]§@*\/&#†‡]+$/},ja:{patterns:[/(.+)を(?:.+)に思い出させて/i,/(?:.+)に(.+)を思い出させて/i,/(?:.+)は(.+)と言うリマインダーを作成して/i],punctuation:new RegExp('[-‾_＿－‐—―〜・･,，、､;；:：!！?？.．‥…。｡＇‘’"＂“”(（)）\\[［\\]］{｛}｝〈〉《》「｢」｣『』【】〔〕‖§¶@＠*＊/／＼&＆#＃%％‰†‡′″〃※]+$',"u")}},g=Object.freeze({normalise:Symbol("normalise"),parseNoDates:Symbol("parseNoDates"),parseMultipleDates:Symbol("parseMultipleDates")}),w=function(){function e(){r(this,e)}return e.prototype.parse=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:"",time:[]},t=null;if(null===e.time){var r=this[g.normalise](e.cleaned);t=this[g.parseNoDates](r)}else if(1===e.time.length){var n=this[g.normalise](e.time[0].processedText);t=this[g.parseNoDates](n)}else if(e.time.length>1){var i=this[g.normalise](e.cleaned);t=this[g.parseMultipleDates](i)}return e.action=t,Promise.resolve(e)},e.prototype[g.normalise]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(v.en.punctuation,"").trim()},e.prototype[g.parseNoDates]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=null;return v.en.patterns.some(function(r){var n=r.exec(e);return!!n&&(t=n[1],!0)}),t},e.prototype[g.parseMultipleDates]=function(){return console.error("Parsing action with multiple time references is not implemented yet."),null},e}(),T=Object.freeze({listFormatter:Symbol("listFormatter"),getLocalised:Symbol("getLocalised"),formatUser:Symbol("formatUser"),formatAction:Symbol("formatAction"),formatTime:Symbol("formatTime"),isToday:Symbol("isToday"),isTomorrow:Symbol("isTomorrow"),isThisMonth:Symbol("isThisMonth"),formatHoursAndMinutes:Symbol("formatHoursAndMinutes")}),M="en",x={en:{template:"OK, I'll remind [users] [action] [time].",formatUser:function(e){return e.replace(/\bme\b/gi,"you").replace(/\bI am\b/gi,"you are").replace(/\bI have\b/gi,"you have").replace(/\bI will\b/gi,"you will").replace(/\bI\b/gi,"you").replace(/\bmy\b/gi,"your").replace(/\bmine\b/gi,"yours")}},fr:{template:"OK, je rappelerai [users] [action] [time].",formatUser:function(e){return e}},ja:{template:"承知しました。[time][users]に[action]をリマインドします。",formatUser:function(e){return e}}},S=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M;r(this,e),this.locale=t,"undefined"!=typeof TwitterCldr?(TwitterCldr.set_data(TwitterCldrDataBundle),this[T.listFormatter]=new TwitterCldr.ListFormatter):this[T.listFormatter]={format:function(e){return e.join(" and ")}}}return e.prototype.confirm=function(e){var t=this[T.getLocalised]("template"),r={users:this[T.formatUser](e),action:this[T.formatAction](e),time:this[T.formatTime](e)};return t.replace(/\[([^\]]+)\]/g,function(e,t){return r[t]})},e.prototype[T.getLocalised]=function(e){var t=this.locale;return x[this.locale]&&x[this.locale][e]||(t=M),x[t][e]},e.prototype[T.formatUser]=function(e){var t=e.recipients,r=this[T.getLocalised]("formatUser"),n=t.map(r);return this[T.listFormatter].format(n)},e.prototype[T.formatAction]=function(e){var t=e.action,r=e.cleaned,n=this[T.getLocalised]("formatUser"),i=n(t),o=new RegExp("\\bthat "+t,"iu"),a=new RegExp("\\bit is "+t,"iu"),s=new RegExp("\\bthere is "+t,"iu"),l=new RegExp("\\babout "+t,"iu");return o.test(r)?"that "+i:a.test(r)?"that it is "+i:s.test(r)?"that there is "+i:l.test(r)?"about "+i:"to "+i},e.prototype[T.formatTime]=function(e){var r=e.due;if(this[T.isToday](r)){var n=this[T.formatHoursAndMinutes](r);return"at "+n+" today"}if(this[T.isTomorrow](r)){var i=this[T.formatHoursAndMinutes](r);return"at "+i+" tomorrow"}return this[T.isThisMonth](r)?t(r).format("[on the] Do"):t(r).format("[on] MMMM [the] Do")},e.prototype[T.isToday]=function(e){var r=t().startOf("day"),n=t().add(1,"day").startOf("day");return t(e).isBetween(r,n)},e.prototype[T.isTomorrow]=function(e){var r=t().add(1,"day").startOf("day"),n=t().add(2,"day").startOf("day");return t(e).isBetween(r,n)},e.prototype[T.isThisMonth]=function(e){var r=t().startOf("month"),n=t().add(1,"month").startOf("month");return t(e).isBetween(r,n)},e.prototype[T.formatHoursAndMinutes]=function(e){e=t(e);var r=void 0;if(0===e.minute())r=e.format("h A");else if(15===e.minute())r=e.format("[quarter past] h A");else if(30===e.minute())r=e.format("[half past] h A");else if(45===e.minute()){var n=e.add(1,"hour");r=n.format("[quarter to] h A")}else r=e.format("h:m A");return r.replace(/([0-9]) ?AM$/gi,"$1 A.M.").replace(/([0-9]) ?PM$/gi,"$1 P.M.")},e}(),P=Object.freeze({reminderConfirmation:Symbol("reminderConfirmation")}),$=function(){function e(){r(this,e),this[P.reminderConfirmation]=new S}return e.prototype.refine=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=null!==e.time&&1===e.time.length&&null!==e.time[0].start&&null===e.time[0].end,r=null!==e.recipients&&e.recipients.length>0,n=null!==e.action;return e.cleaned.toLowerCase().startsWith("remind")&&t&&r&&n&&(e.due=e.time[0].start,e.confirmation=this[P.reminderConfirmation].confirm(e),e.intent="reminder"),Promise.resolve(e)},e}(),A=Object.freeze({time:Symbol("time"),users:Symbol("users"),listFormatter:Symbol("listFormatter"),formatTime:Symbol("formatTime"),isToday:Symbol("isToday"),isTomorrow:Symbol("isTomorrow"),isThisMonth:Symbol("isThisMonth"),formatHoursAndMinutes:Symbol("formatHoursAndMinutes")}),R={en:{formatUser:function(e){return e.replace(/\bme\b/gi,"you").replace(/\bI am\b/gi,"you are").replace(/\bI have\b/gi,"you have").replace(/\bI will\b/gi,"you will").replace(/\bI\b/gi,"you").replace(/\bmy\b/gi,"your").replace(/\bmine\b/gi,"yours")}},fr:{formatUser:function(e){return e}},ja:{formatUser:function(e){return e}}},O=function(){function e(t){var n=t.due,i=t.recipients;r(this,e),"undefined"!=typeof TwitterCldr?(TwitterCldr.set_data(TwitterCldrDataBundle),this[A.listFormatter]=new TwitterCldr.ListFormatter):this[A.listFormatter]={format:function(e){return e.join(" and ")}},this[A.time]=n,this[A.users]=i}return e.prototype.confirm=function(e){var t=this[A.formatUser](this[A.users]);if(!e){var r=this[A.formatTime]({due:this[A.time]});return"I can't find anything scheduled for "+t+" "+r+"."}var n=e.action,i=this[A.formatTime](e);return"you"===t||this[A.users].length>=1?i+", "+t+' have the following activity: "'+n+'".':i+", "+t+' has the following activity: "'+n+'".'},e.prototype[A.formatUser]=function(e){var t=e.map(R.en.formatUser);return this[A.listFormatter].format(t)},e.prototype[A.formatTime]=function(e){var r=e.due,n=this[A.formatHoursAndMinutes](r);if(this[A.isToday](r))return"at "+n+" today";if(this[A.isTomorrow](r))return"at "+n+" tomorrow";if(this[A.isThisMonth](r)){var i=t(r).format("Do");return"at "+n+" on the "+i}var o=t(r).format("MMMM [the] Do");return"at "+n+" on "+o},e.prototype[A.isToday]=function(e){var r=t().startOf("day"),n=t().add(1,"day").startOf("day");return t(e).isBetween(r,n)},e.prototype[A.isTomorrow]=function(e){var r=t().add(1,"day").startOf("day"),n=t().add(2,"day").startOf("day");return t(e).isBetween(r,n)},e.prototype[A.isThisMonth]=function(e){var r=t().startOf("month"),n=t().add(1,"month").startOf("month");return t(e).isBetween(r,n)},e.prototype[A.formatHoursAndMinutes]=function(e){e=t(e);var r=void 0;if(0===e.minute())r=e.format("h A");else if(15===e.minute())r=e.format("[quarter past] h A");else if(30===e.minute())r=e.format("[half past] h A");else if(45===e.minute()){var n=e.add(1,"hour");r=n.format("[quarter to] h A")}else r=e.format("h:m A");return r.replace(/([0-9]) ?AM$/gi,"$1 A.M.").replace(/([0-9]) ?PM$/gi,"$1 P.M.")},e}(),U={en:{formatUser:function(e){return e.replace(/\bI\b/gi,"me").replace(/\bmy\b/gi,"me").replace(/\bmine\b/gi,"me")}},fr:{formatUser:function(e){return e}},ja:{formatUser:function(e){return e}}},C=function(){function e(){r(this,e)}return e.prototype.refine=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=null!==e.time&&1===e.time.length&&null!==e.time[0].start&&null===e.time[0].end,r=null!==e.recipients&&e.recipients.length>0,n=null===e.action;if(e.cleaned.match(/^(?:What|Where|When)/i)&&t&&r&&n){var i=new O({due:e.time[0].start,recipients:e.recipients});e.due=e.time[0].start,e.recipients=e.recipients.map(U.en.formatUser),e.confirmation=i.confirm.bind(i),e.intent="query"}return Promise.resolve(e)},e}(),j=Object.freeze({cleaners:Symbol("cleaners"),parsers:Symbol("parsers"),refiners:Symbol("refiners")}),k=function(){function e(){r(this,e),this[j.cleaners]=[new n,new i,new a,new s],this[j.parsers]=[new h,new b,new w],this[j.refiners]=[new $,new C];var t=new Function("return this")();t.intentParser=this}return e.prototype.parse=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e=String(e);var t={raw:e,intent:null},r=this[j.cleaners].map(function(e){return e.clean.bind(e)}),n=this[j.parsers].map(function(e){return e.parse.bind(e)}),i=this[j.refiners].map(function(e){return e.refine.bind(e)});return new Promise(function(e,o){Promise.resolve(t).then(function(e){return r.reduce(function(e,t){return e.then(t)},Promise.resolve(e))}).then(function(e){return n.reduce(function(e,t){return e.then(t)},Promise.resolve(e))}).then(function(e){return i.reduce(function(e,t){return e.then(t)},Promise.resolve(e))}).then(function(t){return null===t.intent?(console.error("The intent could not be parsed:",t),o(null)):e(t)})})},e}();return k});
//# sourceMappingURL=intent-parser.js.map
