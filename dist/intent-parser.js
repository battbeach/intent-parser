!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("chrono-node"),require("chrono-node/src/utils/EN"),require("moment")):"function"==typeof define&&define.amd?define(["chrono-node","chrono-node/src/utils/EN","moment"],t):e.IntentParser=t(e.chrono,e.chronoUtils,e.moment)}(this,function(e,t,r){"use strict";e="default"in e?e.default:e,t="default"in t?t.default:t,r="default"in r?r.default:r;var n=(function(){function e(e){this.value=e}function t(t){function r(e,t){return new Promise(function(r,o){var s={key:e,arg:t,resolve:r,reject:o,next:null};a?a=a.next=s:(i=a=s,n(e,t))})}function n(r,i){try{var a=t[r](i),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){n("next",e)},function(e){n("throw",e)}):o(a.done?"return":"normal",a.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}i=i.next,i?n(i.key,i.arg):a=null}var i,a;this._invoke=r,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),o=function(){function e(){n(this,e)}return e.prototype.clean=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{raw:""},t=e.raw.replace(/\s+/g," ").trim();return e.text=t,e.cleaned=t,Promise.resolve(e)},e}(),i=function(){function e(){n(this,e)}return e.prototype.clean=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},t=e.cleaned.replace(/\b(let)'s\b/gi,"$1 us").replace(/'s (been|got|gotten)\b/gi," has $1").replace(/'s (being|going)\b/gi," is $1").replace(/'d (like|love)\b/gi," would $1").replace(/\b(should)n't've\b/gi,"$1 not have").replace(/\b(would)n't've\b/gi,"$1 not have").replace(/\b(could)n't've\b/gi,"$1 not have").replace(/\b(s)han't\b/gi,"$1hall not").replace(/\b(w)on't\b/gi,"$1ill not").replace(/\b(c)an't\b/gi,"$1annot").replace(new RegExp("\\b(am|are|could|did|do|does|had|has|have|is|might|must|should|was|were|would)n't\\b","ig"),"$1 not").replace(/\b(g)onna\b/gi,"$1oing to").replace(/\b(w)anna\b/gi,"$1ant to").replace(/'ll\b/gi," will").replace(/'re\b/gi," are").replace(/'ve\b/gi," have").replace(/'m\b/gi," am");return e.cleaned=t,Promise.resolve(e)},e}(),a={en:"[-‐–—,;:!?.…'‘’\"“”()[\\]§@*/&#†‡′″]",fr:'[-‐–—,;:!?.…’"“”«»()[\\]§@*/&#†‡]',ja:'[-‾_＿－‐—―〜・･,，、､;；:：!！?？.．‥…。｡＇‘’"＂“”(（)）\\[［\\]］{｛}｝〈〉《》「｢」｣『』【】〔〕‖§¶@＠*＊/／\\＼&＆#＃%％‰†‡′″〃※]'},s=function(){function e(){n(this,e)}return e.prototype.clean=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},t=e.cleaned.replace(new RegExp("^(?:Hello|Hey|Hi|Yo)"+a.en+"* (.)","i"),function(e,t){return t.toUpperCase()});return e.cleaned=t,Promise.resolve(e)},e}(),u=function(){function e(){n(this,e)}return e.prototype.clean=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},t=e.cleaned.replace(new RegExp("^(?:|Could you please |Please could you |Could you |Would you please |Please would you |Would you |Will you please |Please will you |Will you |Can you please |Please can you |Can you |Please do |Please )?(.)","i"),function(e,t){return t.toUpperCase()});return e.cleaned=t,Promise.resolve(e)},e}(),l=function(){function e(){n(this,e)}return e.prototype.clean=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},t=e.cleaned.replace(new RegExp("^(?:Tell me |Let me know |Inform me |I want to know )wh(at|ere|en|o)\\b","i"),"Wh$1");return t!==e.cleaned&&t.match(/^Wh(at|ere|en|o)\b/i)&&(t=t.replace(/\.+$/,"?")),e.cleaned=t,Promise.resolve(e)},e}(),c=new e.Parser;c.pattern=function(){return new RegExp("\\b(?:midnight|morning|in the morning|noon|afternoon|in the afternoon|evening|in the evening|night|at night)\\b","i")},c.extract=function(t,r,n){var o=void 0,i=void 0;switch(n[0].toLowerCase()){case"midnight":o=0,i=0;break;case"morning":case"in the morning":o=9,i=0;break;case"noon":o=12,i=1;break;case"afternoon":case"in the afternoon":o=15,i=1;break;case"evening":case"in the evening":o=18,i=1;break;case"night":case"at night":o=22,i=1}return new e.ParsedResult({ref:r,text:n[0],index:n.index,start:{hour:o,meridiem:i}})};var m=Object.assign(new e.Parser,{pattern:function(){return new RegExp("\\bthe (([0-9]{1,2})(?:st|nd|rd|th)?|"+t.ORDINAL_WORDS_PATTERN+")\\b","i")},extract:function(r,n,o){var i=o[1],a=o[2],s=a?Number(a):t.ORDINAL_WORDS[i.toLowerCase()],u=n.getDate(),l=n.getMonth(),c=s>=u?l:l+1;return new e.ParsedResult({ref:n,text:o[0],index:o.index,start:{month:c+1,day:s}})}}),f=new e.Refiner;f.refine=function(e,t){function r(e,t){!e.isCertain("meridiem")&&e.moment(t).isSame(e,"day")&&e.get("hour")<=t.getHours()&&(e.assign("meridiem",1),e.assign("hour",e.get("hour")+12))}var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.forwardHoursOnly!==!0?t:(t.forEach(function(e){r(e.start,e.ref),e.end&&r(e.end,e.ref)}),t)};var p=new e.Chrono(e.options.casualOption());p.parsers.push(c),p.parsers.push(m),p.refiners.push(f);var d={parse:function(e){return p.parse(e,null,{forwardDate:!0,forwardDatesOnly:!0,forwardHoursOnly:!0})}},h=Object.freeze({normaliseTimes:Symbol("normaliseTimes")}),y=function(){function e(){n(this,e)}return e.prototype.parse=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},t=this[h.normaliseTimes](e.cleaned),r=d.parse(t);if(!r.length)return e.time=null,Promise.resolve(e);var n=r.map(function(e){var r=e.start?Number(e.start.date()):null,n=e.end?Number(e.end.date()):null,o=e.text,i=t.substr(0,e.index).trim(),a=t.substr(e.index+o.length).trim();/\b(?:on|by)$/.test(i)&&(i=i.slice(0,-3));var s=i+" "+a;return{start:r,end:n,extractedText:o,processedText:s}});return e.time=n,Promise.resolve(e)},e.prototype[h.normaliseTimes]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/([0-9]) ?p\.m\./gi,"$1 PM").replace(/([0-9]) ?a\.m\./gi,"$1 AM")},e}(),b={en:{patterns:[/^Remind (.+?) (?:to|at|on|by|that|about)\b/i,/^Where (?:am|are|is) (.+?) (?:at|on|by)\b/i,/^Where (?:am|are|is) (.+?) supposed to\b/i,/^Where should (.+?) go\b/i,/^What (?:am|are|is) (.+?) doing\b/i,/^What (?:am|are|is) (.+?) supposed to\b/i,/^What should (.+?) do\b/i,/^What (?:do|does) (.+?) do\b/i,/^What is (.+?)(?:'s)? (?:schedule|planning|calendar|agenda)\b/i,/([^ ]+ (?:and|&) [^ ]+)/i],listBreaker:/,? (?:and|&) |, /gi},fr:{patterns:[/Rappelle (.+?) de (?:.+)/i,/Rappelle (.+?) d'(?:.+)/i,/Rappelle-(.+?) de (?:.+)/i,/Rappelle-(.+?) d'(?:.+)/i],listBreaker:/,? (?:et|&) |, /gi},ja:{patterns:[/(?:.+)を(.+)に思い出させて/i,/(.+)に(?:.+)を思い出させて/i,/(.+)は(?:.+)と言うリマインダーを作成して/i],listBreaker:/\u3001/g}},v=Object.freeze({users:Symbol("users"),normalise:Symbol("normalise")}),g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];n(this,e),this[v.users]=t}return e.prototype.parse=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:""},r=t.cleaned,n=null;return b.en.patterns.some(function(t){var o=t.exec(r);return!!o&&(n=e.parseUsers(o[1]),!!n.length)}),t.recipients=n,Promise.resolve(t)},e.prototype.parseUsers=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.split(b.en.listBreaker).map(function(e){return e.trim()}).filter(function(e){return!!e})},e}(),w={en:{patterns:[/Remind (?:.+?) (?:to|at|on|by|that|about) (.+)/i,/Remind (?:.+?) that (?:it|there) is (.+)/i],punctuation:/[-‐–—,;:!?.…'‘’"“”()[\]§@*\/&#†‡′″]+$/},fr:{patterns:[/Rappelle (?:.+?) de (.+)/i,/Rappelle (?:.+?) d'(.+)/i,/Rappelle-(?:.+?) de (.+)/i,/Rappelle-(?:.+?) d'(.+)/i],punctuation:/[-‐–—,;:!?.…’"“”«»()[\]§@*\/&#†‡]+$/},ja:{patterns:[/(.+)を(?:.+)に思い出させて/i,/(?:.+)に(.+)を思い出させて/i,/(?:.+)は(.+)と言うリマインダーを作成して/i],punctuation:/[!-#%&\(-\*,-\/:;\?@\[-\]_\{\}\xA7\xB6\u2010\u2014-\u2016\u2018\u2019\u201C\u201D\u2020\u2021\u2025\u2026\u2030\u2032\u2033\u203B\u203E\u3001-\u3003\u3008-\u3011\u3014\u3015\u301C\u30FB\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF61-\uFF65]+$/}},T=Object.freeze({normalise:Symbol("normalise"),parseNoDates:Symbol("parseNoDates"),parseMultipleDates:Symbol("parseMultipleDates")}),F=function(){function e(){n(this,e)}return e.prototype.parse=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cleaned:"",time:[]},t=null;if(e.time&&e.time.length){if(1===e.time.length){var r=this[T.normalise](e.time[0].processedText);t=this[T.parseNoDates](r)}else if(e.time.length>1){var n=this[T.normalise](e.cleaned);t=this[T.parseMultipleDates](n)}}else{var o=this[T.normalise](e.cleaned);t=this[T.parseNoDates](o)}return e.action=t,Promise.resolve(e)},e.prototype[T.normalise]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(w.en.punctuation,"").trim()},e.prototype[T.parseNoDates]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=null;return w.en.patterns.some(function(r){var n=r.exec(e);return!!n&&(t=n[1],!0)}),t},e.prototype[T.parseMultipleDates]=function(){return console.error("Parsing action with multiple time references is not implemented yet."),null},e}(),M=Object.freeze({listFormatter:Symbol("listFormatter"),getLocalised:Symbol("getLocalised"),formatUser:Symbol("formatUser"),formatAction:Symbol("formatAction"),formatTime:Symbol("formatTime"),isToday:Symbol("isToday"),isTomorrow:Symbol("isTomorrow"),isThisMonth:Symbol("isThisMonth"),formatHoursAndMinutes:Symbol("formatHoursAndMinutes")}),x="en",P={en:{template:"OK, I'll remind [users] [action] [time].",formatUser:function(e){return e.replace(/\bme\b/gi,"you").replace(/\bI am\b/gi,"you are").replace(/\bI have\b/gi,"you have").replace(/\bI will\b/gi,"you will").replace(/\bI\b/gi,"you").replace(/\bmy\b/gi,"your").replace(/\bmine\b/gi,"yours")}},fr:{template:"OK, je rappelerai [users] [action] [time].",formatUser:function(e){return e}},ja:{template:"承知しました。[time][users]に[action]をリマインドします。",formatUser:function(e){return e}}},A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x;n(this,e),this.locale=t,"undefined"==typeof TwitterCldr?this[M.listFormatter]={format:function(e){return e.join(" and ")}}:(TwitterCldr.set_data(TwitterCldrDataBundle),this[M.listFormatter]=new TwitterCldr.ListFormatter)}return e.prototype.confirm=function(e){var t=this[M.getLocalised]("template"),r={users:this[M.formatUser](e),action:this[M.formatAction](e),time:this[M.formatTime](e)};return t.replace(/\[([^\]]+)\]/g,function(e,t){return r[t]})},e.prototype[M.getLocalised]=function(e){var t=this.locale;return P[this.locale]&&P[this.locale][e]||(t=x),P[t][e]},e.prototype[M.formatUser]=function(e){var t=e.recipients,r=this[M.getLocalised]("formatUser"),n=t.map(r);return this[M.listFormatter].format(n)},e.prototype[M.formatAction]=function(e){var t=e.action,r=e.cleaned,n=this[M.getLocalised]("formatUser"),o=n(t),i=new RegExp("\\bthat "+t,"i"),a=new RegExp("\\bit is "+t,"i"),s=new RegExp("\\bthere is "+t,"i"),u=new RegExp("\\babout "+t,"i");return i.test(r)?"that "+o:a.test(r)?"that it is "+o:s.test(r)?"that there is "+o:u.test(r)?"about "+o:"to "+o},e.prototype[M.formatTime]=function(e){var t=e.due;if(this[M.isToday](t)){var n=this[M.formatHoursAndMinutes](t);return"at "+n+" today"}if(this[M.isTomorrow](t)){var o=this[M.formatHoursAndMinutes](t);return"at "+o+" tomorrow"}return this[M.isThisMonth](t)?r(t).format("[on the] Do"):r(t).format("[on] MMMM [the] Do")},e.prototype[M.isToday]=function(e){var t=r().startOf("day"),n=r().add(1,"day").startOf("day");return r(e).isBetween(t,n)},e.prototype[M.isTomorrow]=function(e){var t=r().add(1,"day").startOf("day"),n=r().add(2,"day").startOf("day");return r(e).isBetween(t,n)},e.prototype[M.isThisMonth]=function(e){var t=r().startOf("month"),n=r().add(1,"month").startOf("month");return r(e).isBetween(t,n)},e.prototype[M.formatHoursAndMinutes]=function(e){e=r(e);var t=void 0;if(0===e.minute())t=e.format("h A");else if(15===e.minute())t=e.format("[quarter past] h A");else if(30===e.minute())t=e.format("[half past] h A");else if(45===e.minute()){var n=e.add(1,"hour");t=n.format("[quarter to] h A")}else t=e.format("h:m A");return t.replace(/([0-9]) ?AM$/gi,"$1 A.M.").replace(/([0-9]) ?PM$/gi,"$1 P.M.")},e}(),S=Object.freeze({reminderConfirmation:Symbol("reminderConfirmation")}),O=function(){function e(){n(this,e),this[S.reminderConfirmation]=new A}return e.prototype.refine=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=null!==e.time&&1===e.time.length&&null!==e.time[0].start&&null===e.time[0].end,r=null!==e.recipients&&e.recipients.length>0,n=null!==e.action;return e.cleaned.toLowerCase().startsWith("remind")&&t&&r&&n&&(e.due=e.time[0].start,e.confirmation=this[S.reminderConfirmation].confirm(e),e.intent="reminder"),Promise.resolve(e)},e}(),R=Object.freeze({time:Symbol("time"),users:Symbol("users"),listFormatter:Symbol("listFormatter"),formatTime:Symbol("formatTime"),isToday:Symbol("isToday"),isTomorrow:Symbol("isTomorrow"),isThisMonth:Symbol("isThisMonth"),formatHoursAndMinutes:Symbol("formatHoursAndMinutes")}),$={en:{formatUser:function(e){return e.replace(/\bme\b/gi,"you").replace(/\bI am\b/gi,"you are").replace(/\bI have\b/gi,"you have").replace(/\bI will\b/gi,"you will").replace(/\bI\b/gi,"you").replace(/\bmy\b/gi,"your").replace(/\bmine\b/gi,"yours")}},fr:{formatUser:function(e){return e}},ja:{formatUser:function(e){return e}}},C=function(){function e(t){var r=t.due,o=t.recipients;n(this,e),"undefined"==typeof TwitterCldr?this[R.listFormatter]={format:function(e){return e.join(" and ")}}:(TwitterCldr.set_data(TwitterCldrDataBundle),this[R.listFormatter]=new TwitterCldr.ListFormatter),this[R.time]=r,this[R.users]=o}return e.prototype.confirm=function(e){var t=this[R.formatUser](this[R.users]);if(!e){var r=this[R.formatTime]({due:this[R.time]});return"I can't find anything scheduled for "+t+" "+r+"."}var n=e.action,o=this[R.formatTime](e);return"you"===t||this[R.users].length>=1?o+", "+t+' have the following activity: "'+n+'".':o+", "+t+' has the following activity: "'+n+'".'},e.prototype[R.formatUser]=function(e){var t=e.map($.en.formatUser);return this[R.listFormatter].format(t)},e.prototype[R.formatTime]=function(e){var t=e.due,n=this[R.formatHoursAndMinutes](t);if(this[R.isToday](t))return"at "+n+" today";if(this[R.isTomorrow](t))return"at "+n+" tomorrow";if(this[R.isThisMonth](t)){var o=r(t).format("Do");return"at "+n+" on the "+o}var i=r(t).format("MMMM [the] Do");return"at "+n+" on "+i},e.prototype[R.isToday]=function(e){var t=r().startOf("day"),n=r().add(1,"day").startOf("day");return r(e).isBetween(t,n)},e.prototype[R.isTomorrow]=function(e){var t=r().add(1,"day").startOf("day"),n=r().add(2,"day").startOf("day");return r(e).isBetween(t,n)},e.prototype[R.isThisMonth]=function(e){var t=r().startOf("month"),n=r().add(1,"month").startOf("month");return r(e).isBetween(t,n)},e.prototype[R.formatHoursAndMinutes]=function(e){e=r(e);var t=void 0;if(0===e.minute())t=e.format("h A");else if(15===e.minute())t=e.format("[quarter past] h A");else if(30===e.minute())t=e.format("[half past] h A");else if(45===e.minute()){var n=e.add(1,"hour");t=n.format("[quarter to] h A")}else t=e.format("h:m A");return t.replace(/([0-9]) ?AM$/gi,"$1 A.M.").replace(/([0-9]) ?PM$/gi,"$1 P.M.")},e}(),D={en:{formatUser:function(e){return e.replace(/\bI\b/gi,"me").replace(/\bmy\b/gi,"me").replace(/\bmine\b/gi,"me")}},fr:{formatUser:function(e){return e}},ja:{formatUser:function(e){return e}}},U=function(){function e(){n(this,e)}return e.prototype.refine=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=null!==e.time&&1===e.time.length&&null!==e.time[0].start&&null===e.time[0].end,r=null!==e.recipients&&e.recipients.length>0,n=null===e.action;if(e.cleaned.match(/^(?:What|Where|When)/i)&&t&&r&&n){var o=new C({due:e.time[0].start,recipients:e.recipients});e.due=e.time[0].start,e.recipients=e.recipients.map(D.en.formatUser),e.confirmation=o.confirm.bind(o),e.intent="query"}return Promise.resolve(e)},e}(),j=Object.freeze({cleaners:Symbol("cleaners"),parsers:Symbol("parsers"),refiners:Symbol("refiners")}),k=function(){function e(){n(this,e),this[j.cleaners]=[new o,new i,new s,new u,new l],this[j.parsers]=[new y,new g,new F],this[j.refiners]=[new O,new U];var t=new Function("return this")();t.intentParser=this}return e.prototype.parse=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e=String(e);var t={raw:e,intent:null},r=this[j.cleaners].map(function(e){return e.clean.bind(e)}),n=this[j.parsers].map(function(e){return e.parse.bind(e)}),o=this[j.refiners].map(function(e){return e.refine.bind(e)});return new Promise(function(e,i){Promise.resolve(t).then(function(e){return r.reduce(function(e,t){return e.then(t)},Promise.resolve(e))}).then(function(e){return n.reduce(function(e,t){return e.then(t)},Promise.resolve(e))}).then(function(e){return o.reduce(function(e,t){return e.then(t)},Promise.resolve(e))}).then(function(t){return null===t.intent?(console.error("The intent could not be parsed:",t),i(null)):e(t)})})},e}();return k});
//# sourceMappingURL=intent-parser.js.map
